<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.alone.hotel.dao.RoomOrderRelationDao">
    <resultMap id="roomOrderRelationMap" type="com.alone.hotel.entity.RoomOrder">
        <id column="room_order_id" property="orderId" />
        <collection property="customerList" column="customer_card_number" ofType="com.alone.hotel.entity.Customer">
            <id column="customer_card_number" property="customerCardNumber" />
            <result column="customer_name" property="customerName" />
            <result column="customer_age" property="customerAge" />
            <result column="customer_gender" property="customerGender" />
            <result column="customer_card_img" property="customerCardImg" />
            <result column="customer_face_img" property="customerFaceImg" />
            <result column="customer_phone" property="customerPhone" />
        </collection>
    </resultMap>

    <insert id="addRoomOrderRelation" parameterType="com.alone.hotel.entity.RoomOrderRelation">
        insert into tb_room_order_relation(room_order_id, customer_card_number)
        values (#{roomOrder.orderId}, #{customer.customerCardNumber})
    </insert>

    <select id="queryCustomerByOrderId" resultMap="roomOrderRelationMap" parameterType="String">
        select re.room_order_id, c.customer_card_number, c.customer_name, c.customer_age,
        c.customer_gender, c.customer_card_img, c.customer_face_img, c.customer_phone
        from tb_room_order_relation re, tb_customer c
        where re.customer_card_number = c.customer_card_number
        and re.room_order_id = #{roomOrderId}
    </select>

    <delete id="deleteRoomOrderRelation">
        delete from tb_room_order_relation
        where room_order_id = #{orderId}
    </delete>
</mapper>